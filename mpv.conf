# MPV - mpv.conf
# Configured by Ryuuko:3 - 2024-12-03 - https://github.com/Ryuu43

include="~~/profiles.conf"

# ==========    GENERAL    ==========

autofit=85%x85%
saturation=20
contrast=5
force-seekable=yes                              # If the player thinks that the media is not seekable, force enable seeking
keep-open=yes
reset-on-next-file=pause                        # After playing the next file in the playlist,
msg-color=yes                                 	# Color for console ouput terminal
msg-module=yes
#msg-level=pointer_event=error,input=error,demux=error,autoload=warn,dvdnav=fatal,ad=fatal,ffmpeg=no,ytproxy=debug,stream=no		# Suppress useless warnings
image-display-duration=inf		              	# No autoplay with image
hr-seek=yes                                   	# Turn on precise seeks when possible, seeks will not limited by keyframes
hr-seek-framedrop=no							# set to no could fixes audio desync
input-default-bindings=no						# eh no working anymore
no-input-default-bindings						# this worked for me, idk why the above command didn't work for me
taskbar-progress=no                             # Disable playback progress rendering in taskbar
autocreate-playlist=filter
#force-window=immediate
resume-playback=no
correct-pts=yes
#save-position-on-quit=yes
idle = yes
prefetch-playlist=yes  
gpu-shader-cache-dir = "~~/cache/shader"
watch-later-dir = "~~/cache/watch_later"
log-file="mpv log.txt"							# Log file


# ==========    VIDEO    ==========

# This is what profile=high-quality do:
# scale=ewa_lanczossharp (This also changes the cscale)
# hdr-peak-percentile=99.995
# hdr-contrast-recovery=0.30
# deband=yes

vo=gpu-next                                  	# Video output driver sử dụng libplacebo để render. Hỗ trợ gần như đầy đủ các tính năng giống như --vo=gpu
hwdec=auto-safe									# enable hardware decoding, defaults to 'no' (auto-copy-safe | auto-copy | auto-safe *recommend* | hwdec=videotoolbox | videotoolbox-copy | cuda | cuda-copy | nvdec | nvdec-copy | vdpau-copy | vaapi | vaapi-copy | dxva2 | dxva2-copy | d3d11 | d3d11va | d3d11va-copy | d3d12 | d3d12va | d3d12va-copy )
# hwdec-codecs choose =all but if u got ffmpeg av1 error no HW acceleration then choose nvdec-copy ( nvidia card ) 
# Recommended method to do hardware decoding on NVIDIA GPUs
hwdec-codecs=nvdec-copy							#
profile=Default									# High quality video output, require rather fast video card
priority=high
gpu-api=d3d11									# "vulkan" Linux - "d3d11" (Windows)
# gpu-api=vulkan                              	# Recommend for Linux
framedrop=no
deinterlace=no 									# global reset of deinterlacing to off
########  LOW LATENCY   ########
vd-lavc-fast=yes
# Number of threads to use for decoding. Whether threading is actually supported depends on codec (default: 0). 
# 0 means autodetect number of cores on the machine and use that, up to the maximum of 16 - its can cause high A:V
#vd-lavc-threads=6       						# multithreaded decoding buffers extra frames 
#ad-lavc-threads=6
#gamma-auto=yes									# will be remove in the future

# ==========    ON SCREEN DISPLAY AND ON SCREEN CONTROLLER    ==========

no-border
osd-bar=no                                    	# Use UOSC instead of default UI
osc=no                                        	# Use morden-x UI instead of default
border=no                                     	# Turn off title bar and border and use morden X instead
cursor-autohide=100                           	# The mouse pointer will automatically hide behind the ms
osd-level=1       
osd-on-seek=no                            		# https://mpv.io/manual/stable/#options-osd-level
osd-duration=1000                             	# Appearance time of OSD messages equalsms

# Customize the style of OSD messages
osd-font="XHei Intel"
osd-font-size=20
osd-border-size=0.6
osd-shadow-offset=0.75
osd-color="#CCFFFFFF"
osd-border-color="#DD322640"
osd-fractions=yes
osd-blur=0.2  
osd-bold=yes
osd-bar-align-y=0                       # progress bar y alignment (-1 top, 0 centered, 1 bottom)
osd-bar-h=2                             # height of osd bar as a fractional percentage of your screen height
osd-bar-w=60                            # width of " " "


# ==========    LANGUAGE PRIORITY    ==========

track-auto-selection=yes
alang=ja,jp,jpn,vi,vie,en,eng                 	# Language priority order of audio
slang=vi,vie,en,eng                             	# Language priority order of subtitles

# ==========    AUDIO    ==========

audio-file-auto=fuzzy                   		# external audio doesn't has to match the file name exactly to autoload
audio-pitch-correction=yes              		# automatically insert scaletempo when playing with higher speed
volume-max=200                          		# maximum volume in %, everything above 100 results in amplification
volume=40                              			# default volume, 100 = unchanged
#audio-buffer=1									# Use this if u got messages "Audio Device Buffer Underrun Detected" - default 0.2
#audio-delay=+0.084								# Positive values delay the audio, and negative values delay the video. ( +0.084 = 84ms )
#audio-exclusive=yes							# This is highly recommended for a multi channel soundbar. You need to activate "exclusive mode" in your sound driver on Windows. If u have this error disable this "ao/wasapi: Error initializing device: AUDCLNT_E_BUFFER_SIZE_NOT_ALIGNED (0x88890019)"
#Channels that your device supports
#"auto-safe" only sends channels that your active audio device can handle, which can cause issues for an ARC/eARC setup (uses TV instead of soundbar) 
#"auto" sends every channels as they're, which works for an eARC/ARC setup but also can cause issues if your sound device doesn't support certain channel setups
#An alternative is to set up a whitelist for supported channels
#audio-channels=auto							


# ==========    SUBTITLES    ==========

embeddedfonts=yes                       # use embedded fonts for SSA/ASS subs
demuxer-mkv-subtitle-preroll=yes              	# https://mpv.io/manual/stable/#options-mkv-subtitle-preroll
demuxer-mkv-subtitle-preroll-secs=2
sub-fix-timing=no                             	# Do not try to fix gaps (which might make it worse in some cases).
sub-auto=fuzzy                                	# Load subtitle bên ngoài có tên gần giống với video
sub-file-paths-append=ass
sub-file-paths-append=srt
sub-file-paths-append=pgs
sub-file-paths-append=vob
sub-file-paths-append=sub
sub-file-paths-append=sup
sub-file-paths-append=subs
sub-file-paths-append=subtitles

# The following options apply to subtitles formats that do not have their own style (eg: SRT, VTT...)
# This is my favorite style, you can adjust the style according to your own preferences
sub-font='XHei Intel'
sub-font-size=40
sub-blur=1
sub-ass-style-overrides=WrapStyle=0,Kerning=yes,Spacing=0,MarginL=200,MarginR=200,MarginV=74,Outline=3.6,Shadow=1.5
sub-ass-use-video-data=none
subs-fallback=yes
sub-use-margins=yes
sub-ass-force-margins=yes
sub-color='#FFFFFFFF'
sub-border-color="#FF000000"
sub-shadow-color="#A0000000"
sub-border-size=1.0
sub-margin-x=100 
sub-margin-y=50
sub-shadow-offset=0
sub-spacing=0.5
sub-bold=yes						     
sub-gauss=0.05        	                      	# Gaussian blur factor. 0 means no blur applied (default)
blend-subtitles=no                           	# Subtitle blending in scenechanges (smoother effect)

# ==========    SCREENSHOT    ==========

screenshot-format=png                         	# Format of screenshoot
screenshot-high-bit-depth=no                  	# Bitdepth is the same as video.
screenshot-tag-colorspace=no                  	# Tonemap screenshot
screenshot-png-compression=6                  	# PNG compression ratio (1-9) - High values ​​give better compression, but in return it takes more processing time  
screenshot-dir="~/Pictures/mpv"             	# Directory containing screenshots
screenshot-template="%{?demuxer-via-network==yes:${media-title}%{?demuxer-via-network==yes:_${filename/no-ext}%{!demuxer-via-network==yes:${filename}-%wH.%wM.%wS.%wT-#%#00n" # Định dạng tên (filename-hour-minute-second-milisecond-number)

# ==========    CACHE    ==========

cache=yes    
#cache-on-disk=yes								# Store cache payload on the hard disk instead of in RAM. (This may negatively impact performance unless used for slow input such as network.)
cache-pause	        							# 
#cache-pause-wait=3								# <seconds>
#cache-pause-initial=yes						# This can be used to ensure playback starts smoothly after buffering (as controlled by cache-pause-wait)
cache-secs=600                                 	# Enabling cache is useful when playing back previously over the network
demuxer-max-bytes=4GiB                        	# Limit the data size to allow the demuxer to read first
demuxer-seekable-cache=yes
demuxer-readahead-secs=600                    	# Time limit for allowing demuxer to read first
demuxer-max-back-bytes=2GiB                		# Limit the size of read data the demuxer can store
stream-buffer-size=5MiB          				# KiB, MiB ( 1MiB is optimal more than that affect seekable )
demuxer-lavf-buffersize=5194304  				# Bytes

# ==========    NETWORKING    ==========

tls-verify=no
network-timeout=100
stream-lavf-o-append=reconnect_on_http_error=4xx,5xx
stream-lavf-o-append=reconnect_delay_max=30
stream-lavf-o-append=reconnect_streamed=yes

# ==========   YTDL   ==========

#ytdl-raw-options=ignore-errors=				# Disabled cuz it broke the ytdl-raw-options fetch subtitle
#Speed ​​up video opening, thanks for sharing by MrGTOP https://voz.vn/p/33484033/
script-opts=ytdl_hook-try_ytdl_first=yes,ytdl_hook-exclude="%.webm$|%.ts$|%.mp3$|%.m3u8$|%.m3u$|%.mkv$|%.mp4$|%.VOB$|%.wmv$|%.ogg$|%.mpd$|%.mov$|%.webm$|%.webp$|%.avi$|%.flv$|%.swf$|%.f4v$"
ytdl-raw-options-append=no-check-certificates=
ytdl-raw-options-append=yes-playlist=
ytdl-raw-options-append=no-write-comments=
ytdl-format=bestvideo+bestaudio/best          	# Param selects the source of youtube-dl
load-unsafe-playlists=yes
ytdl-raw-options=sub-lang="vi.*,en.*",yes-playlist=,compat-options="prefer-vp9-sort"


#mark-watched for youtube videos Source: https://voz.vn/t/tong-hop-nhung-addon-chat-cho-firefox-pc-mobile.682181/post-25727088
ytdl-raw-options-append=cookies-from-browser=firefox:C:\Users\Administrator\AppData\Roaming\zen\Profiles\sw4lslhl.Default (alpha)
ytdl-raw-options-append=mark-watched=

# ==========    COLORSPACE    ==========

target-prim=auto
# target-prim=bt.709 # target Rec.709 for SDR TVs
# target-prim=bt.2020 # target Rec.2020 (wide color gamut) for HDR TVs
target-trc=auto
vf=format=colorlevels=full:colormatrix=auto
video-output-levels=full

# ==========   Tone-mapping & HDR - SDR  ==========

target-colorspace-hint=no                     	# Force tonemapping HDR -> SDR if your screen supports HDR then turn it on and enable HDR in Windows settings.
tone-mapping=spline
target-contrast=auto 							# Max contrast ratio of your supported device, usually ~1000 for IPS, ~3000-5000 for VA and inf for OLED)
tone-mapping-param=0.6

# ====================== DEFAULT PROFILE FOR ALL ======================

# ==========    DITHER    ==========

# Use "fruit" (8-Bit/8-Bit+FRC display), "ordered" (true 10-Bit/12-Bit display) or "error-diffusion" with high-end GPUs
# use dither=ordered on vo=gpu-next It's extremely fast
# On vo=gpu stick with dither=fruit
dither-depth=8 								# 6for 6Bit PAL, 8 for 8bit, 10 or 12 for 10bit - Nah just use auto
#temporal-dither=yes
# Use "fruit" (8-Bit/8-Bit+FRC display), "ordered" (true 10-Bit/12-Bit display) or "error-diffusion" with high-end GPUs
# use dither=ordered on vo=gpu-next It's extremely fast
# On vo=gpu stick with dither=fruit
dither=ordered									
#dither=fruit              						#i-GPU/Low-end  
#dither-size-fruit=8 							#i-GPU/Low-end

# ==========    DEBANDING    ==========

# Example of banding: https://imgur.com/32d77H0
# Debanding is the process of removing said banding.
# 6 minute explanation of what causes banding: https://www.youtube.com/watch?v=h9j89L8eQQk

deband=yes                                    	# Should only be turned on when the video has banding, enabled by default but disabled for 4K videos, below. (Toggle Keybind=D) 
deband-iterations=2                           	# https://mpv.io/manual/stable/#options-deband-iterations
deband-threshold=20                         	# https://mpv.io/manual/stable/#options-deband-threshold
deband-range=16									# https://mpv.io/manual/stable/#options-deband-threshold
deband-grain=5                               	# https://mpv.io/manual/stable/#options-deband-grain - dynamic grain: set to "0" if using the static grain shader


# ==========   MOTION INTERPOLATION    ==========

interpolation=yes
video-sync=display-resample
#video-sync-max-video-change=5
tscale=oversample								# ( oversample *recommend* | linear | bicubic | bcspline | catmull_rom | mitchell |spline16 | spline36 | spline64 | ginseng | sinc | robidoux | lanczos |  robidouxsharp | box | nearest | triangle | gaussian | bartlett | cosine | hanning | hamming | tukey | quadric | welch | kaiser | blackman | sphinx )
profile-restore=copy
